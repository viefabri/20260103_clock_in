# 2026/01/03 開発日誌

## 1. 本日の成果
### プロジェクト立ち上げ
- フォルダ構成、仮想環境 (`venv`) のセットアップ
- 必要なライブラリの選定 (`selenium`, `webdriver-manager`, `streamlit`, `apscheduler`)

### コア機能の実装 (`src/`)
- **Git管理外の認証:** Bitwarden CLI (`bw`) を使用し、パスワードをコードに埋め込まない安全な設計を採用。
- **ブラウザ操作:** Selenium による Touch On Time への自動ログイン、打刻（出勤/退勤）処理の実装。
- **CLIツール化:** `main.py` に引数処理を追加し、コマンドラインから打刻を実行可能に。

### Web UIの実装 (`app.py`)
- **Streamlit** を採用し、ブラウザ上で以下の操作を実現：
    - Bitwardenのステータス確認 & ロック解除
    - 実行モード（テスト/本番）、打刻タイプ（出勤/退勤）の選択
    - 実行日時の指定とバックグラウンド予約実行 (`APScheduler`)

### 技術的な改善
- **Native CLIへの移行:** Node.js版 `bw` CLI の不具合回避のため、Linux Native版バイナリ (`bw_native`) を導入。
- **入力安定化:** Streamlit の仕様による入力値リセット問題に対し、デフォルト値を固定化することで対応。

## 2. 発生している課題
### Bitwarden連携の不安定さ
- 予約実行時や画面再描画時に、アンロック状態が維持されない、またはロック解除に失敗するケースがある。
- `st.session_state` やキャッシュの挙動が複雑化しており、整理が必要。

### UI表示の不具合
- ストリーミング表示の関数名（`native function...`）が画面にそのまま出てしまうなど、見た目の調整が必要。

## 3. 次回のアクション
- [ ] **アンロック処理の堅牢化:** セッション管理を見直し、確実に打刻できる状態を作る。
- [ ] **UI/UXの改善:** スピナー表示の修正、不要なデバッグ情報の整理。
- [ ] **リファクタリング:** 急ぎ実装した `app.py` のコード整理。
