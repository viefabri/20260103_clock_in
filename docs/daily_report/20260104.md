# 開発日誌: 2026-01-04

## 実施内容

### 1. ランチャーアプリのModernization (CustomTkinter化)
*   従来の `Tkinter` ベースのUIから、モダンな `CustomTkinter` (`ctk`) へ移行。
*   ダークテーマ、角丸ボタン、レスポンシブなレイアウトを採用し、デザインを刷新。
*   状態管理（Status: Ready -> Running -> Stopped）をUI上に明示的に表示。

### 2. WSLgにおけるタスクバーアイコン問題への対応
Windows Subsystem for Linux GUI (WSLg) 環境特有の問題（RDP-RAIL Shell統合）に対し、複数のアプローチを検証しました。

*   **課題:** `overrideredirect(True)` でウィンドウ枠を消すと、タスクバーからアイコンが消滅し、最小化もできなくなる。
*   **検証1 (Phantom Parent):** 透明な親ウィンドウを作成し、その上にUIを乗せる方式。
    *   結果: 失敗。最小化の同期が不安定で、UIが画面に残ってしまう現象が発生。
*   **検証2 (EWMH / Motif Hints):** `libX11` を直接操作し、ウィンドウマネージャに「枠なし」を要求する方式。
    *   結果: 失敗。Westonコンポジタがヒントを無視する場合があり、OS標準のタイトルバーと重複して「二重枠」になる問題が発生。
*   **結論:** **「OS標準ウィンドウ」へ回帰**することを決定。
    *   CustomTkinter独自のタイトルバーを撤去し、OS標準のタイトルバーを使用。これにより、アイコン表示・最小化・閉じる動作が全て正常に機能することを確認。

### 3. 大規模リファクタリング
コードベースの関心事を分離するため、ディレクトリ構造を再設計しました。

*   **Before:** フラットな構造 (`src/*.py` に全ファイル)
*   **After:** レイヤード構造
    *   `src/config/`: 設定ファイル
    *   `src/core/`: ビジネスロジック (Automator, Bitwarden, Validator)
    *   `src/interfaces/`: UI層 (CLI, GUI, Web)
    *   `src/utils/`: 共通ユーティリティ (Logger)
*   これに伴い、全ファイルのインポートパスを修正し、`Makefile` も更新。

### 4. アプリケーション登録
*   `~/.local/share/applications/touch-on-time.desktop` を作成。
*   これにより、Linux側のスタートメニューにアイコン付きで表示されるよう対応（Windowsタスクバー側への反映はWSLgの仕様による）。

### 5. Streamlit Web UI ショートカットキーの実装
マウスレスで高速に操作できるよう、Web UIにキーボードショートカットを実装しました。
Streamlit標準では機能がないため、`st.components.v1.html` 経由でJavaScriptを注入する高度な手法を採用しました。

*   **実装機能:**
    *   `Alt+Shift+T`: 時刻入力欄へフォーカス (DateではなくTimeを正確に特定)
    *   `Alt+Shift+D`: 日付入力欄へフォーカス
    *   `Shift+S`: スケジュール登録実行
*   **技術的挑戦:**
    *   Streamlitの動的なDOM構造に対し、安定して要素を特定するために `data-testid` を動的に注入 (Attribute Injection)。
    *   XPathの `translate` 関数を用いた大文字小文字を区別しない検索や、ラベルから入力欄を探す「近傍探索」ロジックにより、堅牢性を確保。

## 次のアクション
*   定期的な実行ログの確認と、運用開始。

